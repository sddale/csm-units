\hypertarget{magnitude_8h_source}{}\doxysection{magnitude.\+h}
\label{magnitude_8h_source}\index{csm-\/units/units/src/core/include/units/magnitude.h@{csm-\/units/units/src/core/include/units/magnitude.h}}

\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{//\ The\ MIT\ License\ (MIT)}}
\DoxyCodeLine{00002\ \textcolor{comment}{//}}
\DoxyCodeLine{00003\ \textcolor{comment}{//\ Copyright\ (c)\ 2018\ Mateusz\ Pusz}}
\DoxyCodeLine{00004\ \textcolor{comment}{//}}
\DoxyCodeLine{00005\ \textcolor{comment}{//\ Permission\ is\ hereby\ granted,\ free\ of\ charge,\ to\ any\ person\ obtaining\ a\ copy}}
\DoxyCodeLine{00006\ \textcolor{comment}{//\ of\ this\ software\ and\ associated\ documentation\ files\ (the\ "{}Software"{}),\ to\ deal}}
\DoxyCodeLine{00007\ \textcolor{comment}{//\ in\ the\ Software\ without\ restriction,\ including\ without\ limitation\ the\ rights}}
\DoxyCodeLine{00008\ \textcolor{comment}{//\ to\ use,\ copy,\ modify,\ merge,\ publish,\ distribute,\ sublicense,\ and/or\ sell}}
\DoxyCodeLine{00009\ \textcolor{comment}{//\ copies\ of\ the\ Software,\ and\ to\ permit\ persons\ to\ whom\ the\ Software\ is}}
\DoxyCodeLine{00010\ \textcolor{comment}{//\ furnished\ to\ do\ so,\ subject\ to\ the\ following\ conditions:}}
\DoxyCodeLine{00011\ \textcolor{comment}{//}}
\DoxyCodeLine{00012\ \textcolor{comment}{//\ The\ above\ copyright\ notice\ and\ this\ permission\ notice\ shall\ be\ included\ in\ all}}
\DoxyCodeLine{00013\ \textcolor{comment}{//\ copies\ or\ substantial\ portions\ of\ the\ Software.}}
\DoxyCodeLine{00014\ \textcolor{comment}{//}}
\DoxyCodeLine{00015\ \textcolor{comment}{//\ THE\ SOFTWARE\ IS\ PROVIDED\ "{}AS\ IS"{},\ WITHOUT\ WARRANTY\ OF\ ANY\ KIND,\ EXPRESS\ OR}}
\DoxyCodeLine{00016\ \textcolor{comment}{//\ IMPLIED,\ INCLUDING\ BUT\ NOT\ LIMITED\ TO\ THE\ WARRANTIES\ OF\ MERCHANTABILITY,}}
\DoxyCodeLine{00017\ \textcolor{comment}{//\ FITNESS\ FOR\ A\ PARTICULAR\ PURPOSE\ AND\ NONINFRINGEMENT.\ IN\ NO\ EVENT\ SHALL\ THE}}
\DoxyCodeLine{00018\ \textcolor{comment}{//\ AUTHORS\ OR\ COPYRIGHT\ HOLDERS\ BE\ LIABLE\ FOR\ ANY\ CLAIM,\ DAMAGES\ OR\ OTHER}}
\DoxyCodeLine{00019\ \textcolor{comment}{//\ LIABILITY,\ WHETHER\ IN\ AN\ ACTION\ OF\ CONTRACT,\ TORT\ OR\ OTHERWISE,\ ARISING\ FROM,}}
\DoxyCodeLine{00020\ \textcolor{comment}{//\ OUT\ OF\ OR\ IN\ CONNECTION\ WITH\ THE\ SOFTWARE\ OR\ THE\ USE\ OR\ OTHER\ DEALINGS\ IN\ THE}}
\DoxyCodeLine{00021\ \textcolor{comment}{//\ SOFTWARE.}}
\DoxyCodeLine{00022\ }
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{00024\ }
\DoxyCodeLine{00025\ \textcolor{preprocessor}{\#include\ <units/bits/external/hacks.h>}}
\DoxyCodeLine{00026\ \textcolor{preprocessor}{\#include\ <units/bits/prime.h>}}
\DoxyCodeLine{00027\ \textcolor{preprocessor}{\#include\ <units/ratio.h>}}
\DoxyCodeLine{00028\ \textcolor{preprocessor}{\#include\ <concepts>}}
\DoxyCodeLine{00029\ \textcolor{preprocessor}{\#include\ <cstdint>}}
\DoxyCodeLine{00030\ \textcolor{preprocessor}{\#include\ <exception>}}
\DoxyCodeLine{00031\ \textcolor{preprocessor}{\#include\ <numbers>}}
\DoxyCodeLine{00032\ \textcolor{preprocessor}{\#include\ <optional>}}
\DoxyCodeLine{00033\ }
\DoxyCodeLine{00034\ \textcolor{keyword}{namespace\ }units\ \{}
\DoxyCodeLine{00035\ \textcolor{keyword}{namespace\ }detail\ \{}
\DoxyCodeLine{00036\ \textcolor{comment}{//\ Higher\ numbers\ use\ fewer\ trial\ divisions,\ at\ the\ price\ of\ more\ storage\ space.}}
\DoxyCodeLine{00037\ \textcolor{keyword}{using\ }factorizer\ =\ wheel\_factorizer<4>;}
\DoxyCodeLine{00038\ \}\ \ \textcolor{comment}{//\ namespace\ detail}}
\DoxyCodeLine{00039\ }
\DoxyCodeLine{00055\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{00056\ \textcolor{keyword}{concept\ }\mbox{\hyperlink{conceptunits_1_1_base_rep}{BaseRep}}\ =}
\DoxyCodeLine{00057\ \ \ std::is\_same\_v<T,\ std::intmax\_t>\ ||\ std::is\_same\_v<std::remove\_cvref\_t<\textcolor{keyword}{decltype}(T::value)>,\ \textcolor{keywordtype}{long}\ \textcolor{keywordtype}{double}>;}
\DoxyCodeLine{00058\ }
\DoxyCodeLine{00083\ \textcolor{keyword}{template}<BaseRep\ T>}
\DoxyCodeLine{00084\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structunits_1_1base__power}{base\_power}}\ \{}
\DoxyCodeLine{00085\ \ \ \textcolor{comment}{//\ The\ rational\ power\ to\ which\ the\ base\ is\ raised.}}
\DoxyCodeLine{00086\ \ \ \mbox{\hyperlink{structunits_1_1ratio}{ratio}}\ power\{1\};}
\DoxyCodeLine{00087\ }
\DoxyCodeLine{00088\ \ \ \textcolor{keyword}{constexpr}\ \textcolor{keywordtype}{long}\ \textcolor{keywordtype}{double}\ get\_base()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ T::value;\ \}}
\DoxyCodeLine{00089\ \};}
\DoxyCodeLine{00090\ }
\DoxyCodeLine{00094\ \textcolor{keyword}{template}<>}
\DoxyCodeLine{00095\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structunits_1_1base__power}{base\_power}}<std::intmax\_t>\ \{}
\DoxyCodeLine{00096\ \ \ \textcolor{comment}{//\ The\ value\ of\ the\ basis\ "{}vector"{}.\ \ Must\ be\ prime\ to\ be\ used\ with\ `magnitude`\ (below).}}
\DoxyCodeLine{00097\ \ \ std::intmax\_t\ base;}
\DoxyCodeLine{00098\ }
\DoxyCodeLine{00099\ \ \ \textcolor{comment}{//\ The\ rational\ power\ to\ which\ the\ base\ is\ raised.}}
\DoxyCodeLine{00100\ \ \ \mbox{\hyperlink{structunits_1_1ratio}{ratio}}\ power\{1\};}
\DoxyCodeLine{00101\ }
\DoxyCodeLine{00102\ \ \ \textcolor{keyword}{constexpr}\ std::intmax\_t\ get\_base()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ base;\ \}}
\DoxyCodeLine{00103\ \};}
\DoxyCodeLine{00104\ }
\DoxyCodeLine{00108\ \textcolor{keyword}{template}<std::\textcolor{keywordtype}{int}egral\ T,\ std::convertible\_to<ratio>\ U>}
\DoxyCodeLine{00109\ \mbox{\hyperlink{structunits_1_1base__power}{base\_power}}(T,\ U)\ -\/>\ \mbox{\hyperlink{structunits_1_1base__power}{base\_power<std::intmax\_t>}};}
\DoxyCodeLine{00110\ \textcolor{keyword}{template}<std::\textcolor{keywordtype}{int}egral\ T>}
\DoxyCodeLine{00111\ \mbox{\hyperlink{structunits_1_1base__power}{base\_power}}(T)\ -\/>\ \mbox{\hyperlink{structunits_1_1base__power}{base\_power<std::intmax\_t>}};}
\DoxyCodeLine{00112\ }
\DoxyCodeLine{00113\ \textcolor{comment}{//\ Implementation\ for\ BasePower\ concept\ (below).}}
\DoxyCodeLine{00114\ \textcolor{keyword}{namespace\ }detail\ \{}
\DoxyCodeLine{00115\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{00116\ \textcolor{keyword}{inline}\ \textcolor{keyword}{constexpr}\ \textcolor{keywordtype}{bool}\ is\_base\_power\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00117\ \textcolor{keyword}{template}<BaseRep\ T>}
\DoxyCodeLine{00118\ \textcolor{keyword}{inline}\ \textcolor{keyword}{constexpr}\ \textcolor{keywordtype}{bool}\ is\_base\_power<base\_power<T>>\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00119\ \}\ \ \textcolor{comment}{//\ namespace\ detail}}
\DoxyCodeLine{00120\ }
\DoxyCodeLine{00127\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{00128\ \textcolor{keyword}{concept\ }\mbox{\hyperlink{conceptunits_1_1_base_power}{BasePower}}\ =\ detail::is\_base\_power<T>;}
\DoxyCodeLine{00129\ }
\DoxyCodeLine{00130\ \textcolor{keyword}{namespace\ }detail\ \{}
\DoxyCodeLine{00131\ }
\DoxyCodeLine{00132\ \textcolor{keyword}{constexpr}\ \textcolor{keyword}{auto}\ inverse(\mbox{\hyperlink{conceptunits_1_1_base_power}{BasePower}}\ \textcolor{keyword}{auto}\ bp)}
\DoxyCodeLine{00133\ \{}
\DoxyCodeLine{00134\ \ \ bp.power.num\ *=\ -\/1;}
\DoxyCodeLine{00135\ \ \ \textcolor{keywordflow}{return}\ bp;}
\DoxyCodeLine{00136\ \}}
\DoxyCodeLine{00137\ }
\DoxyCodeLine{00138\ \textcolor{comment}{//\ `widen\_t`\ gives\ the\ widest\ arithmetic\ type\ in\ the\ same\ category,\ for\ intermediate\ computations.}}
\DoxyCodeLine{00139\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{00140\ \textcolor{keyword}{using\ }widen\_t\ =}
\DoxyCodeLine{00141\ \ \ std::conditional\_t<std::is\_arithmetic\_v<T>,}
\DoxyCodeLine{00142\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::conditional\_t<std::is\_floating\_point\_v<T>,\ \textcolor{keywordtype}{long}\ double,}
\DoxyCodeLine{00143\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::conditional\_t<std::is\_signed\_v<T>,\ std::intmax\_t,\ std::uintmax\_t>>,}
\DoxyCodeLine{00144\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ T>;}
\DoxyCodeLine{00145\ }
\DoxyCodeLine{00146\ \textcolor{comment}{//\ Raise\ an\ arbitrary\ arithmetic\ type\ to\ a\ positive\ integer\ power\ at\ compile\ time.}}
\DoxyCodeLine{00147\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{00148\ \textcolor{keyword}{constexpr}\ T\ int\_power(T\ base,\ std::integral\ \textcolor{keyword}{auto}\ exp)}
\DoxyCodeLine{00149\ \{}
\DoxyCodeLine{00150\ \ \ \textcolor{comment}{//\ As\ this\ function\ should\ only\ be\ called\ at\ compile\ time,\ the\ terminations\ herein\ function\ as}}
\DoxyCodeLine{00151\ \ \ \textcolor{comment}{//\ "{}parameter-\/compatible\ static\_asserts"{},\ and\ should\ not\ result\ in\ terminations\ at\ runtime.}}
\DoxyCodeLine{00152\ \ \ \textcolor{keywordflow}{if}\ (exp\ <\ 0)\ \{}
\DoxyCodeLine{00153\ \ \ \ \ std::terminate();\ \ \textcolor{comment}{//\ int\_power\ only\ supports\ positive\ integer\ powers}}
\DoxyCodeLine{00154\ \ \ \}}
\DoxyCodeLine{00155\ }
\DoxyCodeLine{00156\ \ \ \textcolor{keyword}{constexpr}\ \textcolor{keyword}{auto}\ checked\_multiply\ =\ [](\textcolor{keyword}{auto}\ a,\ \textcolor{keyword}{auto}\ b)\ \{}
\DoxyCodeLine{00157\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ result\ =\ a\ *\ b;}
\DoxyCodeLine{00158\ \ \ \ \ UNITS\_DIAGNOSTIC\_PUSH}
\DoxyCodeLine{00159\ \ \ \ \ UNITS\_DIAGNOSTIC\_IGNORE\_FLOAT\_EQUAL}
\DoxyCodeLine{00160\ \ \ \ \ \textcolor{keywordflow}{if}\ (result\ /\ a\ !=\ b)\ \{}
\DoxyCodeLine{00161\ \ \ \ \ \ \ std::terminate();\ \ \textcolor{comment}{//\ Wraparound\ detected}}
\DoxyCodeLine{00162\ \ \ \ \ \}}
\DoxyCodeLine{00163\ \ \ \ \ UNITS\_DIAGNOSTIC\_POP}
\DoxyCodeLine{00164\ \ \ \ \ \textcolor{keywordflow}{return}\ result;}
\DoxyCodeLine{00165\ \ \ \};}
\DoxyCodeLine{00166\ }
\DoxyCodeLine{00167\ \ \ \textcolor{keyword}{constexpr}\ \textcolor{keyword}{auto}\ checked\_square\ =\ [checked\_multiply](\textcolor{keyword}{auto}\ a)\ \{\ \textcolor{keywordflow}{return}\ checked\_multiply(a,\ a);\ \};}
\DoxyCodeLine{00168\ }
\DoxyCodeLine{00169\ \ \ \textcolor{comment}{//\ TODO(chogg):\ Unify\ this\ implementation\ with\ the\ one\ in\ pow.h.\ \ That\ one\ takes\ its\ exponent\ as\ a}}
\DoxyCodeLine{00170\ \ \ \textcolor{comment}{//\ template\ parameter,\ rather\ than\ a\ function\ parameter.}}
\DoxyCodeLine{00171\ }
\DoxyCodeLine{00172\ \ \ \textcolor{keywordflow}{if}\ (exp\ ==\ 0)\ \{}
\DoxyCodeLine{00173\ \ \ \ \ \textcolor{keywordflow}{return}\ T\{1\};}
\DoxyCodeLine{00174\ \ \ \}}
\DoxyCodeLine{00175\ }
\DoxyCodeLine{00176\ \ \ \textcolor{keywordflow}{if}\ (exp\ \%\ 2\ ==\ 1)\ \{}
\DoxyCodeLine{00177\ \ \ \ \ \textcolor{keywordflow}{return}\ checked\_multiply(base,\ int\_power(base,\ exp\ -\/\ 1));}
\DoxyCodeLine{00178\ \ \ \}}
\DoxyCodeLine{00179\ }
\DoxyCodeLine{00180\ \ \ \textcolor{keywordflow}{return}\ checked\_square(int\_power(base,\ exp\ /\ 2));}
\DoxyCodeLine{00181\ \}}
\DoxyCodeLine{00182\ }
\DoxyCodeLine{00183\ }
\DoxyCodeLine{00184\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{00185\ \textcolor{keyword}{constexpr}\ widen\_t<T>\ compute\_base\_power(\mbox{\hyperlink{conceptunits_1_1_base_power}{BasePower}}\ \textcolor{keyword}{auto}\ bp)}
\DoxyCodeLine{00186\ \{}
\DoxyCodeLine{00187\ \ \ \textcolor{comment}{//\ This\ utility\ can\ only\ handle\ integer\ powers.\ \ To\ compute\ rational\ powers\ at\ compile\ time,\ we'll}}
\DoxyCodeLine{00188\ \ \ \textcolor{comment}{//\ need\ to\ write\ a\ custom\ function.}}
\DoxyCodeLine{00189\ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00190\ \ \ \textcolor{comment}{//\ Note\ that\ since\ this\ function\ should\ only\ be\ called\ at\ compile\ time,\ the\ point\ of\ these}}
\DoxyCodeLine{00191\ \ \ \textcolor{comment}{//\ terminations\ is\ to\ act\ as\ "{}static\_assert\ substitutes"{},\ not\ to\ actually\ terminate\ at\ runtime.}}
\DoxyCodeLine{00192\ \ \ \textcolor{keywordflow}{if}\ (bp.power.den\ !=\ 1)\ \{}
\DoxyCodeLine{00193\ \ \ \ \ std::terminate();\ \ \textcolor{comment}{//\ Rational\ powers\ not\ yet\ supported}}
\DoxyCodeLine{00194\ \ \ \}}
\DoxyCodeLine{00195\ }
\DoxyCodeLine{00196\ \ \ \textcolor{keywordflow}{if}\ (bp.power.num\ <\ 0)\ \{}
\DoxyCodeLine{00197\ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{keyword}{constexpr}\ (std::is\_integral\_v<T>)\ \{}
\DoxyCodeLine{00198\ \ \ \ \ \ \ std::terminate();\ \ \textcolor{comment}{//\ Cannot\ represent\ reciprocal\ as\ integer}}
\DoxyCodeLine{00199\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00200\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ T\{1\}\ /\ compute\_base\_power<T>(inverse(bp));}
\DoxyCodeLine{00201\ \ \ \ \ \}}
\DoxyCodeLine{00202\ \ \ \}}
\DoxyCodeLine{00203\ }
\DoxyCodeLine{00204\ \ \ \textcolor{keyword}{auto}\ power\ =\ bp.power.num;}
\DoxyCodeLine{00205\ \ \ \textcolor{keywordflow}{return}\ int\_power(\textcolor{keyword}{static\_cast<}widen\_t<T>\textcolor{keyword}{>}(bp.get\_base()),\ power);}
\DoxyCodeLine{00206\ \}}
\DoxyCodeLine{00207\ }
\DoxyCodeLine{00208\ \textcolor{comment}{//\ A\ converter\ for\ the\ value\ member\ variable\ of\ magnitude\ (below).}}
\DoxyCodeLine{00209\ \textcolor{comment}{//}}
\DoxyCodeLine{00210\ \textcolor{comment}{//\ The\ input\ is\ the\ desired\ result,\ but\ in\ a\ (wider)\ intermediate\ type.\ \ The\ point\ of\ this\ function}}
\DoxyCodeLine{00211\ \textcolor{comment}{//\ is\ to\ cast\ to\ the\ desired\ type,\ but\ avoid\ overflow\ in\ doing\ so.}}
\DoxyCodeLine{00212\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ To,\ \textcolor{keyword}{typename}\ From>}
\DoxyCodeLine{00213\ \textcolor{comment}{//\ TODO(chogg):\ Migrate\ this\ to\ use\ `treat\_as\_floating\_point`.}}
\DoxyCodeLine{00214\ \ \ \textcolor{keyword}{requires}(!std::is\_integral\_v<To>\ ||\ std::is\_integral\_v<From>)}
\DoxyCodeLine{00215\ \textcolor{keyword}{constexpr}\ To\ checked\_static\_cast(From\ x)}
\DoxyCodeLine{00216\ \{}
\DoxyCodeLine{00217\ \ \ \textcolor{comment}{//\ This\ function\ should\ only\ ever\ be\ called\ at\ compile\ time.\ \ The\ purpose\ of\ these\ terminations\ is}}
\DoxyCodeLine{00218\ \ \ \textcolor{comment}{//\ to\ produce\ compiler\ errors,\ because\ we\ cannot\ `static\_assert`\ on\ function\ arguments.}}
\DoxyCodeLine{00219\ \ \ \textcolor{keywordflow}{if}\ \textcolor{keyword}{constexpr}\ (std::is\_integral\_v<To>)\ \{}
\DoxyCodeLine{00220\ \ \ \ \ \textcolor{keywordflow}{if}\ (!std::in\_range<To>(x))\ \{}
\DoxyCodeLine{00221\ \ \ \ \ \ \ std::terminate();\ \ \textcolor{comment}{//\ Cannot\ represent\ magnitude\ in\ this\ type}}
\DoxyCodeLine{00222\ \ \ \ \ \}}
\DoxyCodeLine{00223\ \ \ \}}
\DoxyCodeLine{00224\ }
\DoxyCodeLine{00225\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{static\_cast<}To\textcolor{keyword}{>}(x);}
\DoxyCodeLine{00226\ \}}
\DoxyCodeLine{00227\ \}\ \ \textcolor{comment}{//\ namespace\ detail}}
\DoxyCodeLine{00228\ }
\DoxyCodeLine{00232\ \textcolor{keyword}{template}<BasePower\ T,\ BasePower\ U>}
\DoxyCodeLine{00233\ \textcolor{keyword}{constexpr}\ \textcolor{keywordtype}{bool}\ operator==(T\ t,\ U\ u)}
\DoxyCodeLine{00234\ \{}
\DoxyCodeLine{00235\ \ \ \textcolor{keywordflow}{return}\ std::is\_same\_v<T,\ U>\ \&\&\ (t.get\_base()\ ==\ u.get\_base())\ \&\&\ (t.power\ ==\ u.power);}
\DoxyCodeLine{00236\ \}}
\DoxyCodeLine{00237\ }
\DoxyCodeLine{00241\ \textcolor{keyword}{constexpr}\ \textcolor{keyword}{auto}\ pow(BasePower\ \textcolor{keyword}{auto}\ bp,\ ratio\ p)}
\DoxyCodeLine{00242\ \{}
\DoxyCodeLine{00243\ \ \ bp.power\ =\ bp.power\ *\ p;}
\DoxyCodeLine{00244\ \ \ \textcolor{keywordflow}{return}\ bp;}
\DoxyCodeLine{00245\ \}}
\DoxyCodeLine{00246\ }
\DoxyCodeLine{00247\ \textcolor{comment}{//\ A\ variety\ of\ implementation\ detail\ helpers.}}
\DoxyCodeLine{00248\ \textcolor{keyword}{namespace\ }detail\ \{}
\DoxyCodeLine{00249\ }
\DoxyCodeLine{00250\ \textcolor{comment}{//\ The\ exponent\ of\ `factor`\ in\ the\ prime\ factorization\ of\ `n`.}}
\DoxyCodeLine{00251\ \textcolor{keyword}{constexpr}\ std::intmax\_t\ multiplicity(std::intmax\_t\ factor,\ std::intmax\_t\ n)}
\DoxyCodeLine{00252\ \{}
\DoxyCodeLine{00253\ \ \ std::intmax\_t\ m\ =\ 0;}
\DoxyCodeLine{00254\ \ \ \textcolor{keywordflow}{while}\ (n\ \%\ factor\ ==\ 0)\ \{}
\DoxyCodeLine{00255\ \ \ \ \ n\ /=\ factor;}
\DoxyCodeLine{00256\ \ \ \ \ ++m;}
\DoxyCodeLine{00257\ \ \ \}}
\DoxyCodeLine{00258\ \ \ \textcolor{keywordflow}{return}\ m;}
\DoxyCodeLine{00259\ \}}
\DoxyCodeLine{00260\ }
\DoxyCodeLine{00261\ \textcolor{comment}{//\ Divide\ a\ number\ by\ a\ given\ base\ raised\ to\ some\ power.}}
\DoxyCodeLine{00262\ \textcolor{comment}{//}}
\DoxyCodeLine{00263\ \textcolor{comment}{//\ Undefined\ unless\ base\ >\ 1,\ pow\ >=\ 0,\ and\ (base\ \string^\ pow)\ evenly\ divides\ n.}}
\DoxyCodeLine{00264\ \textcolor{keyword}{constexpr}\ std::intmax\_t\ remove\_power(std::intmax\_t\ base,\ std::intmax\_t\ pow,\ std::intmax\_t\ n)}
\DoxyCodeLine{00265\ \{}
\DoxyCodeLine{00266\ \ \ \textcolor{keywordflow}{while}\ (pow-\/-\/\ >\ 0)\ \{}
\DoxyCodeLine{00267\ \ \ \ \ n\ /=\ base;}
\DoxyCodeLine{00268\ \ \ \}}
\DoxyCodeLine{00269\ \ \ \textcolor{keywordflow}{return}\ n;}
\DoxyCodeLine{00270\ \}}
\DoxyCodeLine{00271\ }
\DoxyCodeLine{00272\ \textcolor{comment}{//\ A\ way\ to\ check\ whether\ a\ number\ is\ prime\ at\ compile\ time.}}
\DoxyCodeLine{00273\ \textcolor{keyword}{constexpr}\ \textcolor{keywordtype}{bool}\ is\_prime(std::intmax\_t\ n)\ \{\ \textcolor{keywordflow}{return}\ (n\ >=\ 0)\ \&\&\ factorizer::is\_prime(\textcolor{keyword}{static\_cast<}std::size\_t\textcolor{keyword}{>}(n));\ \}}
\DoxyCodeLine{00274\ }
\DoxyCodeLine{00275\ \textcolor{keyword}{constexpr}\ \textcolor{keywordtype}{bool}\ is\_valid\_base\_power(\textcolor{keyword}{const}\ BasePower\ \textcolor{keyword}{auto}\&\ bp)}
\DoxyCodeLine{00276\ \{}
\DoxyCodeLine{00277\ \ \ \textcolor{keywordflow}{if}\ (bp.power\ ==\ 0)\ \{}
\DoxyCodeLine{00278\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00279\ \ \ \}}
\DoxyCodeLine{00280\ }
\DoxyCodeLine{00281\ \ \ \textcolor{keywordflow}{if}\ \textcolor{keyword}{constexpr}\ (std::is\_same\_v<\textcolor{keyword}{decltype}(bp.get\_base()),\ std::intmax\_t>)\ \{}
\DoxyCodeLine{00282\ \ \ \ \ \textcolor{comment}{//\ Some\ prime\ numbers\ are\ so\ big,\ that\ we\ can't\ check\ their\ primality\ without\ exhausting\ limits\ on\ constexpr\ steps}}
\DoxyCodeLine{00283\ \ \ \ \ \textcolor{comment}{//\ and/or\ iterations.\ \ We\ can\ still\ \_perform\_\ the\ factorization\ for\ these\ by\ using\ the\ `known\_first\_factor`}}
\DoxyCodeLine{00284\ \ \ \ \ \textcolor{comment}{//\ workaround.\ \ However,\ we\ can't\ \_check\_\ that\ they\ are\ prime,\ because\ this\ workaround\ depends\ on\ the\ input\ being}}
\DoxyCodeLine{00285\ \ \ \ \ \textcolor{comment}{//\ usable\ in\ a\ constexpr\ expression.\ \ This\ is\ true\ for\ `prime\_factorization`\ (below),\ where\ the\ input\ `N`\ is\ a}}
\DoxyCodeLine{00286\ \ \ \ \ \textcolor{comment}{//\ template\ parameter,\ but\ is\ not\ true\ for\ our\ case,\ where\ the\ input\ `bp.get\_base()`\ is\ a\ function\ parameter.\ \ (See}}
\DoxyCodeLine{00287\ \ \ \ \ \textcolor{comment}{//\ http://www.open-\/std.org/jtc1/sc22/wg21/docs/papers/2019/p1045r1.html\ for\ some\ background\ reading\ on\ this}}
\DoxyCodeLine{00288\ \ \ \ \ \textcolor{comment}{//\ distinction.)}}
\DoxyCodeLine{00289\ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00290\ \ \ \ \ \textcolor{comment}{//\ In\ our\ case:\ we\ simply\ give\ up\ on\ excluding\ every\ possible\ ill-\/formed\ base\ power,\ and\ settle\ for\ catching\ the}}
\DoxyCodeLine{00291\ \ \ \ \ \textcolor{comment}{//\ most\ likely\ and\ common\ mistakes.}}
\DoxyCodeLine{00292\ \ \ \ \ \textcolor{keywordflow}{if}\ (\textcolor{keyword}{const}\ \textcolor{keywordtype}{bool}\ too\_big\_to\_check\ =\ (bp.get\_base()\ >\ 1'000'000'000))\ \{}
\DoxyCodeLine{00293\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00294\ \ \ \ \ \}}
\DoxyCodeLine{00295\ }
\DoxyCodeLine{00296\ \ \ \ \ \textcolor{keywordflow}{return}\ is\_prime(bp.get\_base());}
\DoxyCodeLine{00297\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00298\ \ \ \ \ \textcolor{keywordflow}{return}\ bp.get\_base()\ >\ 0;}
\DoxyCodeLine{00299\ \ \ \}}
\DoxyCodeLine{00300\ \}}
\DoxyCodeLine{00301\ }
\DoxyCodeLine{00302\ \textcolor{comment}{//\ A\ function\ object\ to\ apply\ a\ predicate\ to\ all\ consecutive\ pairs\ of\ values\ in\ a\ sequence.}}
\DoxyCodeLine{00303\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ Predicate>}
\DoxyCodeLine{00304\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structunits_1_1detail_1_1pairwise__all}{pairwise\_all}}\ \{}
\DoxyCodeLine{00305\ \ \ Predicate\ predicate;}
\DoxyCodeLine{00306\ }
\DoxyCodeLine{00307\ \ \ \textcolor{keyword}{template}<\textcolor{keyword}{typename}...\ Ts>}
\DoxyCodeLine{00308\ \ \ \textcolor{keyword}{constexpr}\ \textcolor{keywordtype}{bool}\ operator()(Ts\&\&...\ ts)\textcolor{keyword}{\ const}}
\DoxyCodeLine{00309\ \textcolor{keyword}{\ \ }\{}
\DoxyCodeLine{00310\ \ \ \ \ \textcolor{comment}{//\ Carefully\ handle\ different\ sizes,\ avoiding\ unsigned\ integer\ underflow.}}
\DoxyCodeLine{00311\ \ \ \ \ \textcolor{keyword}{constexpr}\ \textcolor{keyword}{auto}\ num\_comparisons\ =\ [](\textcolor{keyword}{auto}\ num\_elements)\ \{}
\DoxyCodeLine{00312\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ (num\_elements\ >\ 1)\ ?\ (num\_elements\ -\/\ 1)\ :\ 0;}
\DoxyCodeLine{00313\ \ \ \ \ \}(\textcolor{keyword}{sizeof}...(Ts));}
\DoxyCodeLine{00314\ }
\DoxyCodeLine{00315\ \ \ \ \ \textcolor{comment}{//\ Compare\ zero\ or\ more\ pairs\ of\ neighbours\ as\ needed.}}
\DoxyCodeLine{00316\ \ \ \ \ \textcolor{keywordflow}{return}\ [\textcolor{keyword}{this}]<std::size\_t...\ Is>(std::tuple<Ts...>\&\&\ t,\ std::index\_sequence<Is...>)\ \{}
\DoxyCodeLine{00317\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ (predicate(std::get<Is>(t),\ std::get<Is\ +\ 1>(t))\ \&\&\ ...);}
\DoxyCodeLine{00318\ \ \ \ \ \}(std::make\_tuple(std::forward<Ts>(ts)...),\ std::make\_index\_sequence<num\_comparisons>());}
\DoxyCodeLine{00319\ \ \ \}}
\DoxyCodeLine{00320\ \};}
\DoxyCodeLine{00321\ }
\DoxyCodeLine{00322\ \textcolor{comment}{//\ Deduction\ guide:\ permit\ constructions\ such\ as\ `pairwise\_all\{std::less\{\}\}`.}}
\DoxyCodeLine{00323\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{00324\ \mbox{\hyperlink{structunits_1_1detail_1_1pairwise__all}{pairwise\_all}}(T)\ -\/>\ \mbox{\hyperlink{structunits_1_1detail_1_1pairwise__all}{pairwise\_all<T>}};}
\DoxyCodeLine{00325\ }
\DoxyCodeLine{00326\ \textcolor{comment}{//\ Check\ whether\ a\ sequence\ of\ (possibly\ heterogeneously\ typed)\ values\ are\ strictly\ increasing.}}
\DoxyCodeLine{00327\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}...\ Ts>}
\DoxyCodeLine{00328\ \ \ \textcolor{keyword}{requires}(std::is\_signed\_v<Ts>\ \&\&\ ...)}
\DoxyCodeLine{00329\ constexpr\ \textcolor{keywordtype}{bool}\ strictly\_increasing(Ts\&\&...\ ts)}
\DoxyCodeLine{00330\ \{}
\DoxyCodeLine{00331\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{structunits_1_1detail_1_1pairwise__all}{pairwise\_all}}\{std::less\{\}\}(std::forward<Ts>(ts)...);}
\DoxyCodeLine{00332\ \}}
\DoxyCodeLine{00333\ }
\DoxyCodeLine{00334\ \textcolor{keyword}{template}<BasePower\ \textcolor{keyword}{auto}...\ BPs>}
\DoxyCodeLine{00335\ \textcolor{keyword}{inline}\ \textcolor{keyword}{constexpr}\ \textcolor{keywordtype}{bool}\ all\_base\_powers\_valid\ =\ (is\_valid\_base\_power(BPs)\ \&\&\ ...);}
\DoxyCodeLine{00336\ }
\DoxyCodeLine{00337\ \textcolor{keyword}{template}<BasePower\ \textcolor{keyword}{auto}...\ BPs>}
\DoxyCodeLine{00338\ \textcolor{keyword}{inline}\ \textcolor{keyword}{constexpr}\ \textcolor{keywordtype}{bool}\ all\_bases\_in\_order\ =\ strictly\_increasing(BPs.get\_base()...);}
\DoxyCodeLine{00339\ }
\DoxyCodeLine{00340\ \textcolor{keyword}{template}<BasePower\ \textcolor{keyword}{auto}...\ BPs>}
\DoxyCodeLine{00341\ \textcolor{keyword}{inline}\ \textcolor{keyword}{constexpr}\ \textcolor{keywordtype}{bool}\ is\_base\_power\_pack\_valid\ =\ all\_base\_powers\_valid<BPs...>\ \&\&\ all\_bases\_in\_order<BPs...>;}
\DoxyCodeLine{00342\ }
\DoxyCodeLine{00343\ \textcolor{keyword}{constexpr}\ \textcolor{keywordtype}{bool}\ is\_rational(BasePower\ \textcolor{keyword}{auto}\ bp)}
\DoxyCodeLine{00344\ \{}
\DoxyCodeLine{00345\ \ \ \textcolor{keywordflow}{return}\ std::is\_integral\_v<\textcolor{keyword}{decltype}(bp.get\_base())>\ \&\&\ (bp.power.den\ ==\ 1);}
\DoxyCodeLine{00346\ \}}
\DoxyCodeLine{00347\ }
\DoxyCodeLine{00348\ \textcolor{keyword}{constexpr}\ \textcolor{keywordtype}{bool}\ is\_integral(BasePower\ \textcolor{keyword}{auto}\ bp)\ \{\ \textcolor{keywordflow}{return}\ is\_rational(bp)\ \&\&\ bp.power.num\ >\ 0;\ \}}
\DoxyCodeLine{00349\ \}\ \ \textcolor{comment}{//\ namespace\ detail}}
\DoxyCodeLine{00350\ }
\DoxyCodeLine{00357\ \textcolor{keyword}{template}<BasePower\ \textcolor{keyword}{auto}...\ BPs>}
\DoxyCodeLine{00358\ \ \ \textcolor{keyword}{requires}\ detail::is\_base\_power\_pack\_valid<BPs...>}
\DoxyCodeLine{00359\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structunits_1_1magnitude}{magnitude}}\ \{}
\DoxyCodeLine{00360\ \ \ \textcolor{comment}{//\ Whether\ this\ magnitude\ represents\ an\ integer.}}
\DoxyCodeLine{00361\ \ \ \textcolor{keyword}{friend}\ \textcolor{keyword}{constexpr}\ \textcolor{keywordtype}{bool}\ is\_integral(\textcolor{keyword}{const}\ \mbox{\hyperlink{structunits_1_1magnitude}{magnitude}}\&)\ \{\ \textcolor{keywordflow}{return}\ (\mbox{\hyperlink{structdetail_1_1is__integral}{detail::is\_integral}}(BPs)\ \&\&\ ...);\ \}}
\DoxyCodeLine{00362\ }
\DoxyCodeLine{00363\ \ \ \textcolor{comment}{//\ Whether\ this\ magnitude\ represents\ a\ rational\ number.}}
\DoxyCodeLine{00364\ \ \ \textcolor{keyword}{friend}\ \textcolor{keyword}{constexpr}\ \textcolor{keywordtype}{bool}\ is\_rational(\textcolor{keyword}{const}\ \mbox{\hyperlink{structunits_1_1magnitude}{magnitude}}\&)\ \{\ \textcolor{keywordflow}{return}\ (detail::is\_rational(BPs)\ \&\&\ ...);\ \}}
\DoxyCodeLine{00365\ \};}
\DoxyCodeLine{00366\ }
\DoxyCodeLine{00367\ \textcolor{comment}{//\ Implementation\ for\ Magnitude\ concept\ (below).}}
\DoxyCodeLine{00368\ \textcolor{keyword}{namespace\ }detail\ \{}
\DoxyCodeLine{00369\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{00370\ \textcolor{keyword}{inline}\ \textcolor{keyword}{constexpr}\ \textcolor{keywordtype}{bool}\ is\_magnitude\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00371\ \textcolor{keyword}{template}<\textcolor{keyword}{auto}...\ BPs>}
\DoxyCodeLine{00372\ \textcolor{keyword}{inline}\ \textcolor{keyword}{constexpr}\ \textcolor{keywordtype}{bool}\ is\_magnitude<\mbox{\hyperlink{structunits_1_1magnitude}{magnitude}}<BPs...>>\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00373\ \}\ \ \textcolor{comment}{//\ namespace\ detail}}
\DoxyCodeLine{00374\ }
\DoxyCodeLine{00378\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{00379\ \textcolor{keyword}{concept\ }\mbox{\hyperlink{conceptunits_1_1_magnitude}{Magnitude}}\ =\ detail::is\_magnitude<T>;}
\DoxyCodeLine{00380\ }
\DoxyCodeLine{00384\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ T,\ \textcolor{keyword}{auto}...\ BPs>}
\DoxyCodeLine{00385\ \textcolor{comment}{//\ TODO(chogg):\ Migrate\ this\ to\ use\ `treat\_as\_floating\_point`.}}
\DoxyCodeLine{00386\ \ \ \textcolor{keyword}{requires}(!std::is\_integral\_v<T>\ ||\ is\_integral(magnitude<BPs...>\{\}))}
\DoxyCodeLine{00387\ \textcolor{keyword}{constexpr}\ T\ get\_value(\textcolor{keyword}{const}\ \mbox{\hyperlink{structunits_1_1magnitude}{magnitude<BPs...>}}\&)}
\DoxyCodeLine{00388\ \{}
\DoxyCodeLine{00389\ \ \ \textcolor{comment}{//\ Force\ the\ expression\ to\ be\ evaluated\ in\ a\ constexpr\ context,\ to\ catch,\ e.g.,\ overflow.}}
\DoxyCodeLine{00390\ \ \ \textcolor{keyword}{constexpr}\ \textcolor{keyword}{auto}\ result\ =\ detail::checked\_static\_cast<T>((detail::compute\_base\_power<T>(BPs)\ *\ ...\ *\ T\{1\}));}
\DoxyCodeLine{00391\ }
\DoxyCodeLine{00392\ \ \ \textcolor{keywordflow}{return}\ result;}
\DoxyCodeLine{00393\ \}}
\DoxyCodeLine{00394\ }
\DoxyCodeLine{00398\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structunits_1_1pi__base}{pi\_base}}\ \{}
\DoxyCodeLine{00399\ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{constexpr}\ \textcolor{keywordtype}{long}\ \textcolor{keywordtype}{double}\ value\ =\ std::numbers::pi\_v<long\ double>;}
\DoxyCodeLine{00400\ \};}
\DoxyCodeLine{00401\ }
\DoxyCodeLine{00405\ \textcolor{keyword}{inline}\ \textcolor{keyword}{constexpr}\ \mbox{\hyperlink{conceptunits_1_1_magnitude}{Magnitude}}\ \textcolor{keyword}{auto}\ mag\_pi\ =\ \mbox{\hyperlink{structunits_1_1magnitude}{magnitude<base\_power<pi\_base>}}\{\}>\{\};}
\DoxyCodeLine{00406\ }
\DoxyCodeLine{00408\ \textcolor{comment}{//\ Magnitude\ equality\ implementation.}}
\DoxyCodeLine{00409\ }
\DoxyCodeLine{00410\ \textcolor{keyword}{template}<\textcolor{keyword}{auto}...\ LeftBPs,\ \textcolor{keyword}{auto}...\ RightBPs>}
\DoxyCodeLine{00411\ \textcolor{keyword}{constexpr}\ \textcolor{keywordtype}{bool}\ operator==(magnitude<LeftBPs...>,\ magnitude<RightBPs...>)}
\DoxyCodeLine{00412\ \{}
\DoxyCodeLine{00413\ \ \ \textcolor{keywordflow}{if}\ \textcolor{keyword}{constexpr}\ (\textcolor{keyword}{sizeof}...(LeftBPs)\ ==\ \textcolor{keyword}{sizeof}...(RightBPs))\ \{}
\DoxyCodeLine{00414\ \ \ \ \ \textcolor{keywordflow}{return}\ ((LeftBPs\ ==\ RightBPs)\ \&\&\ ...);}
\DoxyCodeLine{00415\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00416\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00417\ \ \ \}}
\DoxyCodeLine{00418\ \}}
\DoxyCodeLine{00419\ }
\DoxyCodeLine{00421\ \textcolor{comment}{//\ Magnitude\ rational\ powers\ implementation.}}
\DoxyCodeLine{00422\ }
\DoxyCodeLine{00423\ \textcolor{keyword}{template}<ratio\ E,\ \textcolor{keyword}{auto}...\ BPs>}
\DoxyCodeLine{00424\ \textcolor{keyword}{constexpr}\ \textcolor{keyword}{auto}\ pow(magnitude<BPs...>)}
\DoxyCodeLine{00425\ \{}
\DoxyCodeLine{00426\ \ \ \textcolor{keywordflow}{if}\ \textcolor{keyword}{constexpr}\ (E.num\ ==\ 0)\ \{}
\DoxyCodeLine{00427\ \ \ \ \ \textcolor{keywordflow}{return}\ magnitude<>\{\};}
\DoxyCodeLine{00428\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00429\ \ \ \ \ \textcolor{keywordflow}{return}\ magnitude<pow(BPs,\ E)...>\{\};}
\DoxyCodeLine{00430\ \ \ \}}
\DoxyCodeLine{00431\ \}}
\DoxyCodeLine{00432\ }
\DoxyCodeLine{00433\ \textcolor{keyword}{template}<\textcolor{keyword}{auto}...\ BPs>}
\DoxyCodeLine{00434\ \textcolor{keyword}{constexpr}\ \textcolor{keyword}{auto}\ sqrt(magnitude<BPs...>\ m)}
\DoxyCodeLine{00435\ \{}
\DoxyCodeLine{00436\ \ \ \textcolor{keywordflow}{return}\ pow<ratio\{1,\ 2\}>(m);}
\DoxyCodeLine{00437\ \}}
\DoxyCodeLine{00438\ }
\DoxyCodeLine{00439\ \textcolor{keyword}{template}<\textcolor{keyword}{auto}...\ BPs>}
\DoxyCodeLine{00440\ \textcolor{keyword}{constexpr}\ \textcolor{keyword}{auto}\ cbrt(magnitude<BPs...>\ m)}
\DoxyCodeLine{00441\ \{}
\DoxyCodeLine{00442\ \ \ \textcolor{keywordflow}{return}\ pow<ratio\{1,\ 3\}>(m);}
\DoxyCodeLine{00443\ \}}
\DoxyCodeLine{00444\ }
\DoxyCodeLine{00446\ \textcolor{comment}{//\ Magnitude\ product\ implementation.}}
\DoxyCodeLine{00447\ }
\DoxyCodeLine{00448\ \textcolor{comment}{//\ Base\ cases,\ for\ when\ either\ (or\ both)\ inputs\ are\ the\ identity.}}
\DoxyCodeLine{00449\ \textcolor{keyword}{constexpr}\ Magnitude\ \textcolor{keyword}{auto}\ operator*(magnitude<>,\ magnitude<>)\ \{\ \textcolor{keywordflow}{return}\ magnitude<>\{\};\ \}}
\DoxyCodeLine{00450\ \textcolor{keyword}{constexpr}\ Magnitude\ \textcolor{keyword}{auto}\ operator*(magnitude<>,\ Magnitude\ \textcolor{keyword}{auto}\ m)\ \{\ \textcolor{keywordflow}{return}\ m;\ \}}
\DoxyCodeLine{00451\ \textcolor{keyword}{constexpr}\ Magnitude\ \textcolor{keyword}{auto}\ operator*(Magnitude\ \textcolor{keyword}{auto}\ m,\ magnitude<>)\ \{\ \textcolor{keywordflow}{return}\ m;\ \}}
\DoxyCodeLine{00452\ }
\DoxyCodeLine{00453\ \textcolor{comment}{//\ Recursive\ case\ for\ the\ product\ of\ any\ two\ non-\/identity\ Magnitudes.}}
\DoxyCodeLine{00454\ \textcolor{keyword}{template}<\textcolor{keyword}{auto}\ H1,\ \textcolor{keyword}{auto}...\ T1,\ \textcolor{keyword}{auto}\ H2,\ \textcolor{keyword}{auto}...\ T2>}
\DoxyCodeLine{00455\ \textcolor{keyword}{constexpr}\ Magnitude\ \textcolor{keyword}{auto}\ operator*(magnitude<H1,\ T1...>,\ magnitude<H2,\ T2...>)}
\DoxyCodeLine{00456\ \{}
\DoxyCodeLine{00457\ \ \ \textcolor{comment}{//\ Case\ for\ when\ H1\ has\ the\ smaller\ base.}}
\DoxyCodeLine{00458\ \ \ \textcolor{keywordflow}{if}\ \textcolor{keyword}{constexpr}\ (H1.get\_base()\ <\ H2.get\_base())\ \{}
\DoxyCodeLine{00459\ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{keyword}{constexpr}\ (\textcolor{keyword}{sizeof}...(T1)\ ==\ 0)\ \{}
\DoxyCodeLine{00460\ \ \ \ \ \ \ \textcolor{comment}{//\ Shortcut\ for\ the\ "{}pure\ prepend"{}\ case,\ which\ makes\ it\ easier\ to\ implement\ some\ of\ the\ other\ cases.}}
\DoxyCodeLine{00461\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ magnitude<H1,\ H2,\ T2...>\{\};}
\DoxyCodeLine{00462\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00463\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ magnitude<H1>\{\}\ *\ (magnitude<T1...>\{\}\ *\ magnitude<H2,\ T2...>\{\});}
\DoxyCodeLine{00464\ \ \ \ \ \}}
\DoxyCodeLine{00465\ \ \ \}}
\DoxyCodeLine{00466\ }
\DoxyCodeLine{00467\ \ \ \textcolor{comment}{//\ Case\ for\ when\ H2\ has\ the\ smaller\ base.}}
\DoxyCodeLine{00468\ \ \ \textcolor{keywordflow}{if}\ \textcolor{keyword}{constexpr}\ (H1.get\_base()\ >\ H2.get\_base())\ \{}
\DoxyCodeLine{00469\ \ \ \ \ \textcolor{keywordflow}{return}\ magnitude<H2>\{\}\ *\ (magnitude<H1,\ T1...>\{\}\ *\ magnitude<T2...>\{\});}
\DoxyCodeLine{00470\ \ \ \}}
\DoxyCodeLine{00471\ }
\DoxyCodeLine{00472\ \ \ \textcolor{comment}{//\ "{}Same\ leading\ base"{}\ case.}}
\DoxyCodeLine{00473\ \ \ \textcolor{keywordflow}{if}\ \textcolor{keyword}{constexpr}\ (H1.get\_base()\ ==\ H2.get\_base())\ \{}
\DoxyCodeLine{00474\ \ \ \ \ \textcolor{keyword}{constexpr}\ \textcolor{keyword}{auto}\ partial\_product\ =\ magnitude<T1...>\{\}\ *\ magnitude<T2...>\{\};}
\DoxyCodeLine{00475\ }
\DoxyCodeLine{00476\ \ \ \ \ \textcolor{comment}{//\ Make\ a\ new\ base\_power\ with\ the\ common\ base\ of\ H1\ and\ H2,\ whose\ power\ is\ their\ powers'\ sum.}}
\DoxyCodeLine{00477\ \ \ \ \ \textcolor{keyword}{constexpr}\ \textcolor{keyword}{auto}\ new\_head\ =\ [\&](\textcolor{keyword}{auto}\ head)\ \{}
\DoxyCodeLine{00478\ \ \ \ \ \ \ head.power\ =\ H1.power\ +\ H2.power;}
\DoxyCodeLine{00479\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ head;}
\DoxyCodeLine{00480\ \ \ \ \ \}(H1);}
\DoxyCodeLine{00481\ }
\DoxyCodeLine{00482\ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{keyword}{constexpr}\ (new\_head.power\ ==\ 0)\ \{}
\DoxyCodeLine{00483\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ partial\_product;}
\DoxyCodeLine{00484\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00485\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ magnitude<new\_head>\{\}\ *\ partial\_product;}
\DoxyCodeLine{00486\ \ \ \ \ \}}
\DoxyCodeLine{00487\ \ \ \}}
\DoxyCodeLine{00488\ \}}
\DoxyCodeLine{00489\ }
\DoxyCodeLine{00491\ \textcolor{comment}{//\ Magnitude\ quotient\ implementation.}}
\DoxyCodeLine{00492\ }
\DoxyCodeLine{00493\ \textcolor{keyword}{constexpr}\ \textcolor{keyword}{auto}\ operator/(Magnitude\ \textcolor{keyword}{auto}\ l,\ Magnitude\ \textcolor{keyword}{auto}\ r)\ \{\ \textcolor{keywordflow}{return}\ l\ *\ pow<-\/1>(r);\ \}}
\DoxyCodeLine{00494\ }
\DoxyCodeLine{00496\ \textcolor{comment}{//\ Magnitude\ numerator\ and\ denominator\ implementation.}}
\DoxyCodeLine{00497\ }
\DoxyCodeLine{00498\ \textcolor{keyword}{namespace\ }detail\ \{}
\DoxyCodeLine{00499\ }
\DoxyCodeLine{00500\ \textcolor{comment}{//\ The\ largest\ integer\ which\ can\ be\ extracted\ from\ any\ magnitude\ with\ only\ a\ single\ basis\ vector.}}
\DoxyCodeLine{00501\ \textcolor{keyword}{template}<auto\ BP>}
\DoxyCodeLine{00502\ \textcolor{keyword}{constexpr}\ \textcolor{keyword}{auto}\ integer\_part(magnitude<BP>)}
\DoxyCodeLine{00503\ \{}
\DoxyCodeLine{00504\ \ \ \textcolor{keyword}{constexpr}\ \textcolor{keyword}{auto}\ power\_num\ =\ BP.power.num;}
\DoxyCodeLine{00505\ \ \ \textcolor{keyword}{constexpr}\ \textcolor{keyword}{auto}\ power\_den\ =\ BP.power.den;}
\DoxyCodeLine{00506\ }
\DoxyCodeLine{00507\ \ \ \textcolor{keywordflow}{if}\ \textcolor{keyword}{constexpr}\ (std::is\_integral\_v<\textcolor{keyword}{decltype}(BP.get\_base())>\ \&\&\ (power\_num\ >=\ power\_den))\ \{}
\DoxyCodeLine{00508\ \ \ \ \ \textcolor{keyword}{constexpr}\ \textcolor{keyword}{auto}\ largest\_integer\_power\ =\ [=](BasePower\ \textcolor{keyword}{auto}\ bp)\ \{}
\DoxyCodeLine{00509\ \ \ \ \ \ \ bp.power\ =\ (power\_num\ /\ power\_den);\ \ \textcolor{comment}{//\ Note:\ integer\ division\ intended.}}
\DoxyCodeLine{00510\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ bp;}
\DoxyCodeLine{00511\ \ \ \ \ \}(BP);\ \ \textcolor{comment}{//\ Note:\ lambda\ is\ immediately\ invoked.}}
\DoxyCodeLine{00512\ }
\DoxyCodeLine{00513\ \ \ \ \ \textcolor{keywordflow}{return}\ magnitude<largest\_integer\_power>\{\};}
\DoxyCodeLine{00514\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00515\ \ \ \ \ \textcolor{keywordflow}{return}\ magnitude<>\{\};}
\DoxyCodeLine{00516\ \ \ \}}
\DoxyCodeLine{00517\ \}}
\DoxyCodeLine{00518\ }
\DoxyCodeLine{00519\ \}\ \ \textcolor{comment}{//\ namespace\ detail}}
\DoxyCodeLine{00520\ }
\DoxyCodeLine{00521\ \textcolor{keyword}{template}<\textcolor{keyword}{auto}...\ BPs>}
\DoxyCodeLine{00522\ \textcolor{keyword}{constexpr}\ \textcolor{keyword}{auto}\ numerator(magnitude<BPs...>)}
\DoxyCodeLine{00523\ \{}
\DoxyCodeLine{00524\ \ \ \textcolor{keywordflow}{return}\ (detail::integer\_part(magnitude<BPs>\{\})\ *\ ...\ *\ magnitude<>\{\});}
\DoxyCodeLine{00525\ \}}
\DoxyCodeLine{00526\ }
\DoxyCodeLine{00527\ \textcolor{keyword}{constexpr}\ \textcolor{keyword}{auto}\ denominator(Magnitude\ \textcolor{keyword}{auto}\ m)\ \{\ \textcolor{keywordflow}{return}\ numerator(pow<-\/1>(m));\ \}}
\DoxyCodeLine{00528\ }
\DoxyCodeLine{00529\ \textcolor{comment}{//\ Implementation\ of\ conversion\ to\ ratio\ goes\ here,\ because\ it\ needs\ `numerator()`\ and\ `denominator()`.}}
\DoxyCodeLine{00530\ \textcolor{keyword}{constexpr}\ ratio\ as\_ratio(Magnitude\ \textcolor{keyword}{auto}\ m)}
\DoxyCodeLine{00531\ \ \ \textcolor{keyword}{requires}(is\_rational(\textcolor{keyword}{decltype}(m)\{\}))}
\DoxyCodeLine{00532\ \{}
\DoxyCodeLine{00533\ \ \ \textcolor{keywordflow}{return}\ ratio\{}
\DoxyCodeLine{00534\ \ \ \ \ get\_value<std::intmax\_t>(numerator(m)),}
\DoxyCodeLine{00535\ \ \ \ \ get\_value<std::intmax\_t>(denominator(m)),}
\DoxyCodeLine{00536\ \ \ \};}
\DoxyCodeLine{00537\ \}}
\DoxyCodeLine{00538\ }
\DoxyCodeLine{00539\ }
\DoxyCodeLine{00541\ \textcolor{comment}{//\ Common\ Magnitude.}}
\DoxyCodeLine{00542\ \textcolor{comment}{//}}
\DoxyCodeLine{00543\ \textcolor{comment}{//\ The\ "{}common\ Magnitude"{}\ C,\ of\ two\ Magnitudes\ M1\ and\ M2,\ is\ the\ largest\ Magnitude\ such\ that\ each\ of\ its\ inputs\ is}}
\DoxyCodeLine{00544\ \textcolor{comment}{//\ expressible\ by\ only\ positive\ basis\ powers\ relative\ to\ C.\ \ That\ is,\ both\ (M1\ /\ C)\ and\ (M2\ /\ C)\ contain\ only\ positive}}
\DoxyCodeLine{00545\ \textcolor{comment}{//\ powers\ in\ the\ expansion\ on\ our\ basis.}}
\DoxyCodeLine{00546\ \textcolor{comment}{//}}
\DoxyCodeLine{00547\ \textcolor{comment}{//\ For\ rational\ Magnitudes\ (or,\ more\ precisely,\ Magnitudes\ that\ are\ rational\ \_relative\ to\ each\ other\_),\ this\ reduces\ to}}
\DoxyCodeLine{00548\ \textcolor{comment}{//\ the\ familiar\ convention\ from\ the\ std::chrono\ library:\ it\ is\ the\ largest\ Magnitude\ C\ such\ that\ each\ input\ Magnitude\ is}}
\DoxyCodeLine{00549\ \textcolor{comment}{//\ an\ \_integer\ multiple\_\ of\ C.\ \ The\ connection\ can\ be\ seen\ by\ considering\ the\ definition\ in\ the\ above\ paragraph,\ and}}
\DoxyCodeLine{00550\ \textcolor{comment}{//\ recognizing\ that\ both\ the\ bases\ and\ the\ powers\ are\ all\ integers\ for\ rational\ Magnitudes.}}
\DoxyCodeLine{00551\ \textcolor{comment}{//}}
\DoxyCodeLine{00552\ \textcolor{comment}{//\ For\ relatively\ \_irrational\_\ Magnitudes\ (whether\ from\ irrational\ bases,\ or\ fractional\ powers\ of\ integer\ bases),\ the}}
\DoxyCodeLine{00553\ \textcolor{comment}{//\ notion\ of\ a\ "{}common\ type"{}\ becomes\ less\ important,\ because\ there\ is\ no\ way\ to\ preserve\ pure\ integer\ multiplication.}}
\DoxyCodeLine{00554\ \textcolor{comment}{//\ When\ we\ go\ to\ retrieve\ our\ value,\ we'll\ be\ stuck\ with\ a\ floating\ point\ approximation\ no\ matter\ what\ choice\ we\ make.}}
\DoxyCodeLine{00555\ \textcolor{comment}{//\ Thus,\ we\ make\ the\ \_simplest\_\ choice\ which\ reproduces\ the\ correct\ convention\ in\ the\ rational\ case:\ namely,\ taking\ the}}
\DoxyCodeLine{00556\ \textcolor{comment}{//\ minimum\ power\ for\ each\ base\ (where\ absent\ bases\ implicitly\ have\ a\ power\ of\ 0).}}
\DoxyCodeLine{00557\ }
\DoxyCodeLine{00558\ \textcolor{keyword}{namespace\ }detail\ \{}
\DoxyCodeLine{00559\ \textcolor{keyword}{template}<auto\ BP>}
\DoxyCodeLine{00560\ \textcolor{keyword}{constexpr}\ \textcolor{keyword}{auto}\ remove\_positive\_power(magnitude<BP>\ m)}
\DoxyCodeLine{00561\ \{}
\DoxyCodeLine{00562\ \ \ \textcolor{keywordflow}{if}\ \textcolor{keyword}{constexpr}\ (BP.power.num\ <\ 0)\ \{}
\DoxyCodeLine{00563\ \ \ \ \ \textcolor{keywordflow}{return}\ m;}
\DoxyCodeLine{00564\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00565\ \ \ \ \ \textcolor{keywordflow}{return}\ magnitude<>\{\};}
\DoxyCodeLine{00566\ \ \ \}}
\DoxyCodeLine{00567\ \}}
\DoxyCodeLine{00568\ }
\DoxyCodeLine{00569\ \textcolor{keyword}{template}<\textcolor{keyword}{auto}...\ BPs>}
\DoxyCodeLine{00570\ \textcolor{keyword}{constexpr}\ \textcolor{keyword}{auto}\ remove\_positive\_powers(magnitude<BPs...>)}
\DoxyCodeLine{00571\ \{}
\DoxyCodeLine{00572\ \ \ \textcolor{keywordflow}{return}\ (magnitude<>\{\}\ *\ ...\ *\ remove\_positive\_power(magnitude<BPs>\{\}));}
\DoxyCodeLine{00573\ \}}
\DoxyCodeLine{00574\ \}\ \ \textcolor{comment}{//\ namespace\ detail}}
\DoxyCodeLine{00575\ }
\DoxyCodeLine{00576\ \textcolor{comment}{//\ Base\ cases,\ for\ when\ either\ (or\ both)\ inputs\ are\ the\ identity.}}
\DoxyCodeLine{00577\ \textcolor{keyword}{constexpr}\ \textcolor{keyword}{auto}\ common\_magnitude(magnitude<>,\ magnitude<>)\ \{\ \textcolor{keywordflow}{return}\ magnitude<>\{\};\ \}}
\DoxyCodeLine{00578\ \textcolor{keyword}{constexpr}\ \textcolor{keyword}{auto}\ common\_magnitude(magnitude<>,\ Magnitude\ \textcolor{keyword}{auto}\ m)\ \{\ \textcolor{keywordflow}{return}\ detail::remove\_positive\_powers(m);\ \}}
\DoxyCodeLine{00579\ \textcolor{keyword}{constexpr}\ \textcolor{keyword}{auto}\ common\_magnitude(Magnitude\ \textcolor{keyword}{auto}\ m,\ magnitude<>)\ \{\ \textcolor{keywordflow}{return}\ detail::remove\_positive\_powers(m);\ \}}
\DoxyCodeLine{00580\ }
\DoxyCodeLine{00581\ \textcolor{comment}{//\ Recursive\ case\ for\ the\ common\ Magnitude\ of\ any\ two\ non-\/identity\ Magnitudes.}}
\DoxyCodeLine{00582\ \textcolor{keyword}{template}<\textcolor{keyword}{auto}\ H1,\ \textcolor{keyword}{auto}...\ T1,\ \textcolor{keyword}{auto}\ H2,\ \textcolor{keyword}{auto}...\ T2>}
\DoxyCodeLine{00583\ \textcolor{keyword}{constexpr}\ \textcolor{keyword}{auto}\ common\_magnitude(magnitude<H1,\ T1...>,\ magnitude<H2,\ T2...>)}
\DoxyCodeLine{00584\ \{}
\DoxyCodeLine{00585\ \ \ \textcolor{keyword}{using\ }detail::remove\_positive\_power;}
\DoxyCodeLine{00586\ }
\DoxyCodeLine{00587\ \ \ \textcolor{keywordflow}{if}\ \textcolor{keyword}{constexpr}\ (H1.get\_base()\ <\ H2.get\_base())\ \{}
\DoxyCodeLine{00588\ \ \ \ \ \textcolor{comment}{//\ When\ H1\ has\ the\ smaller\ base,\ prepend\ to\ result\ from\ recursion.}}
\DoxyCodeLine{00589\ \ \ \ \ \textcolor{keywordflow}{return}\ remove\_positive\_power(magnitude<H1>\{\})\ *\ common\_magnitude(magnitude<T1...>\{\},\ magnitude<H2,\ T2...>\{\});}
\DoxyCodeLine{00590\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ \textcolor{keyword}{constexpr}\ (H2.get\_base()\ <\ H1.get\_base())\ \{}
\DoxyCodeLine{00591\ \ \ \ \ \textcolor{comment}{//\ When\ H2\ has\ the\ smaller\ base,\ prepend\ to\ result\ from\ recursion.}}
\DoxyCodeLine{00592\ \ \ \ \ \textcolor{keywordflow}{return}\ remove\_positive\_power(magnitude<H2>\{\})\ *\ common\_magnitude(magnitude<H1,\ T1...>\{\},\ magnitude<T2...>\{\});}
\DoxyCodeLine{00593\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00594\ \ \ \ \ \textcolor{comment}{//\ When\ the\ bases\ are\ equal,\ pick\ whichever\ has\ the\ lower\ power.}}
\DoxyCodeLine{00595\ \ \ \ \ \textcolor{keyword}{constexpr}\ \textcolor{keyword}{auto}\ common\_tail\ =\ common\_magnitude(magnitude<T1...>\{\},\ magnitude<T2...>\{\});}
\DoxyCodeLine{00596\ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{keyword}{constexpr}\ (H1.power\ <\ H2.power)\ \{}
\DoxyCodeLine{00597\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ magnitude<H1>\{\}\ *\ common\_tail;}
\DoxyCodeLine{00598\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00599\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ magnitude<H2>\{\}\ *\ common\_tail;}
\DoxyCodeLine{00600\ \ \ \ \ \}}
\DoxyCodeLine{00601\ \ \ \}}
\DoxyCodeLine{00602\ \}}
\DoxyCodeLine{00603\ }
\DoxyCodeLine{00605\ \textcolor{comment}{//\ `mag()`\ implementation.}}
\DoxyCodeLine{00606\ }
\DoxyCodeLine{00607\ \textcolor{comment}{//\ Sometimes\ we\ need\ to\ give\ the\ compiler\ a\ "{}shortcut"{}\ when\ factorizing\ large\ numbers\ (specifically,\ numbers\ whose}}
\DoxyCodeLine{00608\ \textcolor{comment}{//\ \_first\ factor\_\ is\ very\ large).\ \ If\ we\ don't,\ we\ can\ run\ into\ limits\ on\ the\ number\ of\ constexpr\ steps\ or\ iterations.}}
\DoxyCodeLine{00609\ \textcolor{comment}{//}}
\DoxyCodeLine{00610\ \textcolor{comment}{//\ To\ provide\ the\ first\ factor\ for\ a\ given\ number,\ specialize\ this\ variable\ template.}}
\DoxyCodeLine{00611\ \textcolor{comment}{//}}
\DoxyCodeLine{00612\ \textcolor{comment}{//\ WARNING:\ \ The\ program\ behaviour\ will\ be\ undefined\ if\ you\ provide\ a\ wrong\ answer,\ so\ check\ your\ math!}}
\DoxyCodeLine{00613\ \textcolor{keyword}{template}<std::\textcolor{keywordtype}{int}max\_t\ N>}
\DoxyCodeLine{00614\ \textcolor{keyword}{inline}\ \textcolor{keyword}{constexpr}\ std::optional<std::intmax\_t>\ known\_first\_factor\ =\ std::nullopt;}
\DoxyCodeLine{00615\ }
\DoxyCodeLine{00616\ \textcolor{keyword}{namespace\ }detail\ \{}
\DoxyCodeLine{00617\ \textcolor{comment}{//\ Helper\ to\ perform\ prime\ factorization\ at\ compile\ time.}}
\DoxyCodeLine{00618\ \textcolor{keyword}{template}<std::\textcolor{keywordtype}{int}max\_t\ N>}
\DoxyCodeLine{00619\ \ \ \textcolor{keyword}{requires}(N\ >\ 0)}
\DoxyCodeLine{00620\ \textcolor{keyword}{struct}\ \mbox{\hyperlink{structunits_1_1detail_1_1prime__factorization}{prime\_factorization}}\ \{}
\DoxyCodeLine{00621\ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{constexpr}\ std::intmax\_t\ get\_or\_compute\_first\_factor()}
\DoxyCodeLine{00622\ \ \ \{}
\DoxyCodeLine{00623\ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{keyword}{constexpr}\ (known\_first\_factor<N>.has\_value())\ \{}
\DoxyCodeLine{00624\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ known\_first\_factor<N>.value();}
\DoxyCodeLine{00625\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00626\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{static\_cast<}std::intmax\_t\textcolor{keyword}{>}(factorizer::find\_first\_factor(N));}
\DoxyCodeLine{00627\ \ \ \ \ \}}
\DoxyCodeLine{00628\ \ \ \}}
\DoxyCodeLine{00629\ }
\DoxyCodeLine{00630\ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{constexpr}\ std::intmax\_t\ first\_base\ =\ get\_or\_compute\_first\_factor();}
\DoxyCodeLine{00631\ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{constexpr}\ std::intmax\_t\ first\_power\ =\ multiplicity(first\_base,\ N);}
\DoxyCodeLine{00632\ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{constexpr}\ std::intmax\_t\ remainder\ =\ remove\_power(first\_base,\ first\_power,\ N);}
\DoxyCodeLine{00633\ }
\DoxyCodeLine{00634\ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{constexpr}\ \textcolor{keyword}{auto}\ value\ =}
\DoxyCodeLine{00635\ \ \ \ \ \mbox{\hyperlink{structunits_1_1magnitude}{magnitude}}<\mbox{\hyperlink{structunits_1_1base__power}{base\_power}}\{first\_base,\ first\_power\}>\{\}\ *\ \mbox{\hyperlink{structunits_1_1detail_1_1prime__factorization}{prime\_factorization<remainder>::value}};}
\DoxyCodeLine{00636\ \};}
\DoxyCodeLine{00637\ }
\DoxyCodeLine{00638\ \textcolor{comment}{//\ Specialization\ for\ the\ prime\ factorization\ of\ 1\ (base\ case).}}
\DoxyCodeLine{00639\ \textcolor{keyword}{template}<>}
\DoxyCodeLine{00640\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structunits_1_1detail_1_1prime__factorization}{prime\_factorization}}<1>\ \{}
\DoxyCodeLine{00641\ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{constexpr}\ \mbox{\hyperlink{structunits_1_1magnitude}{magnitude<>}}\ value\{\};}
\DoxyCodeLine{00642\ \};}
\DoxyCodeLine{00643\ }
\DoxyCodeLine{00644\ \textcolor{keyword}{template}<std::\textcolor{keywordtype}{int}max\_t\ N>}
\DoxyCodeLine{00645\ \textcolor{keyword}{inline}\ \textcolor{keyword}{constexpr}\ \textcolor{keyword}{auto}\ prime\_factorization\_v\ =\ \mbox{\hyperlink{structunits_1_1detail_1_1prime__factorization}{prime\_factorization<N>::value}};}
\DoxyCodeLine{00646\ \}\ \ \textcolor{comment}{//\ namespace\ detail}}
\DoxyCodeLine{00647\ }
\DoxyCodeLine{00654\ \textcolor{keyword}{template}<ratio\ R>}
\DoxyCodeLine{00655\ \ \ \textcolor{keyword}{requires}(R.num\ >\ 0)}
\DoxyCodeLine{00656\ \textcolor{keyword}{constexpr}\ \mbox{\hyperlink{conceptunits_1_1_magnitude}{Magnitude}}\ \textcolor{keyword}{auto}\ mag()}
\DoxyCodeLine{00657\ \{}
\DoxyCodeLine{00658\ \ \ \textcolor{keywordflow}{return}\ detail::prime\_factorization\_v<R.num>\ /\ detail::prime\_factorization\_v<R.den>;}
\DoxyCodeLine{00659\ \}}
\DoxyCodeLine{00660\ }
\DoxyCodeLine{00664\ \textcolor{keyword}{template}<ratio\ Base,\ ratio\ Pow>}
\DoxyCodeLine{00665\ \ \ \textcolor{keyword}{requires}(Base.num\ >\ 0)}
\DoxyCodeLine{00666\ \textcolor{keyword}{constexpr}\ Magnitude\ \textcolor{keyword}{auto}\ mag\_power()}
\DoxyCodeLine{00667\ \{}
\DoxyCodeLine{00668\ \ \ \textcolor{keywordflow}{return}\ pow<Pow>(mag<Base>());}
\DoxyCodeLine{00669\ \}}
\DoxyCodeLine{00670\ }
\DoxyCodeLine{00671\ \textcolor{keyword}{namespace\ }detail\ \{}
\DoxyCodeLine{00672\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ T,\ BasePower\ \textcolor{keyword}{auto}...\ BPs>}
\DoxyCodeLine{00673\ \textcolor{keyword}{constexpr}\ ratio\ get\_power(T\ base,\ magnitude<BPs...>)}
\DoxyCodeLine{00674\ \{}
\DoxyCodeLine{00675\ \ \ \textcolor{keywordflow}{return}\ ((BPs.get\_base()\ ==\ base\ ?\ BPs.power\ :\ ratio\{0\})\ +\ ...\ +\ ratio\{0\});}
\DoxyCodeLine{00676\ \}}
\DoxyCodeLine{00677\ }
\DoxyCodeLine{00678\ \textcolor{keyword}{constexpr}\ std::intmax\_t\ integer\_part(ratio\ r)\ \{\ \textcolor{keywordflow}{return}\ r.num\ /\ r.den;\ \}}
\DoxyCodeLine{00679\ }
\DoxyCodeLine{00680\ \textcolor{keyword}{constexpr}\ std::intmax\_t\ extract\_power\_of\_10(Magnitude\ \textcolor{keyword}{auto}\ m)}
\DoxyCodeLine{00681\ \{}
\DoxyCodeLine{00682\ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ power\_of\_2\ =\ get\_power(2,\ m);}
\DoxyCodeLine{00683\ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ power\_of\_5\ =\ get\_power(5,\ m);}
\DoxyCodeLine{00684\ }
\DoxyCodeLine{00685\ \ \ \textcolor{keywordflow}{if}\ ((power\_of\_2\ *\ power\_of\_5).num\ <=\ 0)\ \{}
\DoxyCodeLine{00686\ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{00687\ \ \ \}}
\DoxyCodeLine{00688\ }
\DoxyCodeLine{00689\ \ \ \textcolor{keywordflow}{return}\ integer\_part((detail::abs(power\_of\_2)\ <\ detail::abs(power\_of\_5))\ ?\ power\_of\_2\ :\ power\_of\_5);}
\DoxyCodeLine{00690\ \}}
\DoxyCodeLine{00691\ \}\ \ \textcolor{comment}{//\ namespace\ detail}}
\DoxyCodeLine{00692\ }
\DoxyCodeLine{00693\ \}\ \ \textcolor{comment}{//\ namespace\ units}}

\end{DoxyCode}
